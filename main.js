/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";function t(t,e){var r=t<e,n=t<e*e&&t>e*e-e,o=t%e==0,i=t%e==e-1;switch(t){case 0:return"top-left";case e-1:return"top-right";case e*e-1:return"bottom-right";case e*e-e:return"bottom-left"}return r?"top":n?"bottom":o?"left":i?"right":"center"}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=n(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return c=t.done,t},e:function(t){s=!0,a=t},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw a}}}}function n(t,e){if(t){if("string"==typeof t)return o(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,a(n.key),n)}}function a(t){var r=function(t){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}var c=function(){return e=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]},a=[{key:"bindToDOM",value:function(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}},{key:"drawUi",value:function(e){var r=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(function(t){return r.onNewGameClick(t)})),this.saveGameEl.addEventListener("click",(function(t){return r.onSaveGameClick(t)})),this.loadGameEl.addEventListener("click",(function(t){return r.onLoadGameClick(t)})),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(var n=0;n<Math.pow(this.boardSize,2);n+=1){var o=document.createElement("div");o.classList.add("cell","map-tile","map-tile-".concat(t(n,this.boardSize))),o.addEventListener("mouseenter",(function(t){return r.onCellEnter(t)})),o.addEventListener("mouseleave",(function(t){return r.onCellLeave(t)})),o.addEventListener("click",(function(t){return r.onCellClick(t)})),this.boardEl.appendChild(o)}this.cells=Array.from(this.boardEl.children)}},{key:"redrawPositions",value:function(t){var e,n=r(this.cells);try{for(n.s();!(e=n.n()).done;)e.value.innerHTML=""}catch(t){n.e(t)}finally{n.f()}var o,i,a=r(t);try{for(a.s();!(o=a.n()).done;){var c=o.value,s=this.boardEl.children[c.position],u=document.createElement("div");u.classList.add("character",c.character.type);var l=document.createElement("div");l.classList.add("health-level");var f=document.createElement("div");f.classList.add("health-level-indicator","health-level-indicator-".concat((i=c.character.health)<15?"critical":i<50?"normal":"high")),f.style.width="".concat(c.character.health,"%"),l.appendChild(f),u.appendChild(l),s.appendChild(u)}}catch(t){a.e(t)}finally{a.f()}}},{key:"addCellEnterListener",value:function(t){this.cellEnterListeners.push(t)}},{key:"addCellLeaveListener",value:function(t){this.cellLeaveListeners.push(t)}},{key:"addCellClickListener",value:function(t){this.cellClickListeners.push(t)}},{key:"addNewGameListener",value:function(t){this.newGameListeners.push(t)}},{key:"addSaveGameListener",value:function(t){this.saveGameListeners.push(t)}},{key:"addLoadGameListener",value:function(t){this.loadGameListeners.push(t)}},{key:"onCellEnter",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellLeave",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellClick",value:function(t){var e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onNewGameClick",value:function(t){t.preventDefault(),this.newGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onSaveGameClick",value:function(t){t.preventDefault(),this.saveGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onLoadGameClick",value:function(t){t.preventDefault(),this.loadGameListeners.forEach((function(t){return t.call(null)}))}},{key:"selectCell",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(t),this.cells[t].classList.add("selected","selected-".concat(e))}},{key:"deselectCell",value:function(t){var e,r=this.cells[t];(e=r.classList).remove.apply(e,function(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||n(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(Array.from(r.classList).filter((function(t){return t.startsWith("selected")}))))}},{key:"showCellTooltip",value:function(t,e){this.cells[e].title=t}},{key:"hideCellTooltip",value:function(t){this.cells[t].title=""}},{key:"showDamage",value:function(t,e){var r=this;return new Promise((function(n){var o=r.cells[t],i=document.createElement("span");i.textContent=e,i.classList.add("damage"),o.appendChild(i),i.addEventListener("animationend",(function(){o.removeChild(i),n()}))}))}},{key:"setCursor",value:function(t){this.boardEl.style.cursor=t}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}],c=[{key:"showError",value:function(t){alert(t)}},{key:"showMessage",value:function(t){alert(t)}}],a&&i(e.prototype,a),c&&i(e,c),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,a,c}();const s={prairie:"prairie",desert:"desert",arctic:"arctic",mountain:"mountain"};function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function f(t){var e=function(t){if("object"!=u(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:e+""}var h=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.characters=[]},(e=[{key:"add",value:function(t){this.characters.push(t)}}])&&l(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function y(t){return function(t){if(Array.isArray(t))return d(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function m(){m=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new G(n||[]);return o(a,"_invoke",{value:k(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",y="suspendedYield",d="executing",v="completed",b={};function g(){}function w(){}function C(){}var P={};u(P,a,(function(){return this}));var S=Object.getPrototypeOf,O=S&&S(S(I([])));O&&O!==r&&n.call(O,a)&&(P=O);var E=C.prototype=g.prototype=Object.create(P);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==p(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function k(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=x(c,n);if(s){if(s===b)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?v:y,u.arg===b)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function x(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,b;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,b):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function G(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(p(e)+" is not iterable")}return w.prototype=C,o(E,"constructor",{value:C,configurable:!0}),o(C,"constructor",{value:w,configurable:!0}),w.displayName=u(C,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,C):(t.__proto__=C,u(t,s,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},L(j.prototype),u(j.prototype,c,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(E),u(E,s,"Generator"),u(E,a,(function(){return this})),u(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,G.prototype={constructor:G,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),b}},e}var v=m().mark(b);function b(t,e){var r,n,o;return m().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:r=function(t,e){return Math.floor(Math.random()*(e-t)+t)};case 1:return n=r(0,t.length),o=r(1,e+1),i.next=6,new t[n](o);case 6:i.next=1;break;case 8:case"end":return i.stop()}}),v)}function g(t,e,r){for(var n=new h,o=b(t,e),i=0;i<r;i+=1)n.add(o.next().value);return n}var w=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=[],n=0;n<63;n+=1)n%8!=0&&n%8!=1||r.push(n);if(e)for(var o=function(t){var n=r.findIndex((function(r){return r===e[t]}));r.splice(n,1)},i=0;i<e.length;i+=1)o(i);for(var a=[],c=0;c<t;c+=1){var s=Math.floor(Math.random()*(r.length-0)+0);a.push(r[s]),r.splice(s,1)}return a},C=function(t){for(var e=[],r=0;r<63;r+=1)r%8!=7&&r%8!=6||e.push(r);for(var n=[],o=0;o<t;o+=1){var i=Math.floor(Math.random()*(e.length-0)+0);n.push(e[i]),e.splice(i,1)}return n};function P(t,e){var r=t%8==0,n=t%8==7,o=[],i=[],a=[],c=[],s=[],u=[],l=[],f=[],h=[];switch(e){case"magician":case"daemon":r?(o=-1,s=-1,l=-1):(s=(o=t-1)-8,l=o+8),n?(i=-1,u=-1,f=-1):(u=(i=t+1)-8,f=i+8),h=[o,i,a=t-8,c=t+8,s,u,l,f];break;case"bowman":case"vampire":if(r)o=[-1],s=[-1],l=[-1];else{var p=(o=[t-1,t-2]).findIndex((function(t){return t%8==0}));-1!==p?(o=y(o).slice(0,p+1),s=[].concat(y(o.map((function(t){return t-8}))),y(o.map((function(t){return t-16})))),l=[].concat(y(o.map((function(t){return t+8}))),y(o.map((function(t){return t+16}))))):(s=[].concat(y(o.map((function(t){return t-8}))),y(o.map((function(t){return t-16})))),l=[].concat(y(o.map((function(t){return t+8}))),y(o.map((function(t){return t+16})))))}if(n)i=[-1],u=[-1],f=[-1];else{var d=(i=[t+1,t+2]).findIndex((function(t){return t%8==7}));-1!==d?(i=y(i).slice(0,d+1),u=[].concat(y(i.map((function(t){return t-8}))),y(i.map((function(t){return t-16})))),f=[].concat(y(i.map((function(t){return t+8}))),y(i.map((function(t){return t+16}))))):(u=[].concat(y(i.map((function(t){return t-8}))),y(i.map((function(t){return t-16})))),f=[].concat(y(i.map((function(t){return t+8}))),y(i.map((function(t){return t+16})))))}a=[t-8,t-16],c=[t+8,t+16],h=[].concat(y(o),y(i),y(a),y(c),y(s),y(l),y(u),y(f));break;case"swordsman":case"undead":if(r)o=[-1],s=[-1],l=[-1];else{var m=(o=[t-1,t-2,t-3,t-4]).findIndex((function(t){return t%8==0}));-1!==m?(o=y(o).slice(0,m+1),s=[].concat(y(o.map((function(t){return t-8}))),y(o.map((function(t){return t-16}))),y(o.map((function(t){return t-24}))),y(o.map((function(t){return t-32})))),l=[].concat(y(o.map((function(t){return t+8}))),y(o.map((function(t){return t+16}))),y(o.map((function(t){return t+24}))),y(o.map((function(t){return t+32}))))):(s=[].concat(y(o.map((function(t){return t-8}))),y(o.map((function(t){return t-16}))),y(o.map((function(t){return t-24}))),y(o.map((function(t){return t-32})))),l=[].concat(y(o.map((function(t){return t+8}))),y(o.map((function(t){return t+16}))),y(o.map((function(t){return t+24}))),y(o.map((function(t){return t+32})))))}if(n)i=[-1],u=[-1],f=[-1];else{var v=(i=[t+1,t+2,t+3,t+4]).findIndex((function(t){return t%8==7}));-1!==v?(i=y(i).slice(0,v+1),u=[].concat(y(i.map((function(t){return t-8}))),y(i.map((function(t){return t-16}))),y(i.map((function(t){return t-24}))),y(i.map((function(t){return t-32})))),f=[].concat(y(i.map((function(t){return t+8}))),y(i.map((function(t){return t+16}))),y(i.map((function(t){return t+24}))),y(i.map((function(t){return t+32}))))):(u=[].concat(y(i.map((function(t){return t-8}))),y(i.map((function(t){return t-16}))),y(i.map((function(t){return t-24}))),y(i.map((function(t){return t-32})))),f=[].concat(y(i.map((function(t){return t+8}))),y(i.map((function(t){return t+16}))),y(i.map((function(t){return t+24}))),y(i.map((function(t){return t+32})))))}a=[t-8,t-16,t-24,t-32],c=[t+8,t+16,t+24,t+32],h=[].concat(y(o),y(i),y(a),y(c),y(s),y(l),y(u),y(f))}return h.filter((function(t){return t>=0&&t<=63}))}function S(t,e){var r=t%8==0,n=t%8==7,o=[],i=[],a=[],c=[],s=[],u=[],l=[],f=[],h=[];switch(e){case"swordsman":case"undead":r?(o=-1,s=-1,l=-1):(s=(o=t-1)-8,l=o+8),n?(i=-1,u=-1,f=-1):(u=(i=t+1)-8,f=i+8),h=[o,i,a=t-8,c=t+8,s,u,l,f];break;case"bowman":case"vampire":if(r)o=[-1],s=[-1],l=[-1];else{var p=(o=[t-1,t-2]).findIndex((function(t){return t%8==0}));-1!==p?(o=y(o).slice(0,p+1),s=[].concat(y(o.map((function(t){return t-8}))),y(o.map((function(t){return t-16})))),l=[].concat(y(o.map((function(t){return t+8}))),y(o.map((function(t){return t+16}))))):(s=[].concat(y(o.map((function(t){return t-8}))),y(o.map((function(t){return t-16})))),l=[].concat(y(o.map((function(t){return t+8}))),y(o.map((function(t){return t+16})))))}if(n)i=[-1],u=[-1],f=[-1];else{var d=(i=[t+1,t+2]).findIndex((function(t){return t%8==7}));-1!==d?(i=y(i).slice(0,d+1),u=[].concat(y(i.map((function(t){return t-8}))),y(i.map((function(t){return t-16})))),f=[].concat(y(i.map((function(t){return t+8}))),y(i.map((function(t){return t+16}))))):(u=[].concat(y(i.map((function(t){return t-8}))),y(i.map((function(t){return t-16})))),f=[].concat(y(i.map((function(t){return t+8}))),y(i.map((function(t){return t+16})))))}a=[t-8,t-16],c=[t+8,t+16],h=[].concat(y(o),y(i),y(a),y(c),y(s),y(l),y(u),y(f));break;case"magician":case"daemon":if(r)o=[-1],s=[-1],l=[-1];else{var m=(o=[t-1,t-2,t-3,t-4]).findIndex((function(t){return t%8==0}));-1!==m?(o=y(o).slice(0,m+1),s=[].concat(y(o.map((function(t){return t-8}))),y(o.map((function(t){return t-16}))),y(o.map((function(t){return t-24}))),y(o.map((function(t){return t-32})))),l=[].concat(y(o.map((function(t){return t+8}))),y(o.map((function(t){return t+16}))),y(o.map((function(t){return t+24}))),y(o.map((function(t){return t+32}))))):(s=[].concat(y(o.map((function(t){return t-8}))),y(o.map((function(t){return t-16}))),y(o.map((function(t){return t-24}))),y(o.map((function(t){return t-32})))),l=[].concat(y(o.map((function(t){return t+8}))),y(o.map((function(t){return t+16}))),y(o.map((function(t){return t+24}))),y(o.map((function(t){return t+32})))))}if(n)i=[-1],u=[-1],f=[-1];else{var v=(i=[t+1,t+2,t+3,t+4]).findIndex((function(t){return t%8==7}));-1!==v?(i=y(i).slice(0,v+1),u=[].concat(y(i.map((function(t){return t-8}))),y(i.map((function(t){return t-16}))),y(i.map((function(t){return t-24}))),y(i.map((function(t){return t-32})))),f=[].concat(y(i.map((function(t){return t+8}))),y(i.map((function(t){return t+16}))),y(i.map((function(t){return t+24}))),y(i.map((function(t){return t+32}))))):(u=[].concat(y(i.map((function(t){return t-8}))),y(i.map((function(t){return t-16}))),y(i.map((function(t){return t-24}))),y(i.map((function(t){return t-32})))),f=[].concat(y(i.map((function(t){return t+8}))),y(i.map((function(t){return t+16}))),y(i.map((function(t){return t+24}))),y(i.map((function(t){return t+32})))))}a=[t-8,t-16,t-24,t-32],c=[t+8,t+16,t+24,t+32],h=[].concat(y(o),y(i),y(a),y(c),y(s),y(l),y(u),y(f))}return h.filter((function(t){return t>=0&&t<=63}))}function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function E(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,L(n.key),n)}}function L(t){var e=function(t){if("object"!=O(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=O(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==O(e)?e:e+""}var j=function(){return t=function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(this instanceof t?this.constructor:void 0)===t)throw new Error("Cant create a of class Character");switch(e){case 2:this.levelUp();case 3:this.levelUp();case 4:this.levelUp()}this.level=e,this.attack=0,this.defence=0,this.health=50,this.type=r},(e=[{key:"levelUp",value:function(){this.level+=1;var t=this.attack;this.attack=Math.max(t,t*(80+this.health)/100),this.health<=20?this.health+=80:this.health=100}}])&&E(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function k(t){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k(t)}function x(t,e,r){return e=T(e),function(t,e){if(e&&("object"==k(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,_()?Reflect.construct(e,r||[],T(t).constructor):e.apply(t,r))}function _(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_=function(){return!!t})()}function T(t){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},T(t)}function G(t,e){return G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},G(t,e)}var I=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=x(this,e,[t,"bowman"])).attack=25,r.defence=25,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&G(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(j);function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function A(t,e,r){return e=M(e),function(t,e){if(e&&("object"==B(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,N()?Reflect.construct(e,r||[],M(t).constructor):e.apply(t,r))}function N(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(N=function(){return!!t})()}function M(t){return M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},M(t)}function D(t,e){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},D(t,e)}var R=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=A(this,e,[t,"swordsman"])).attack=40,r.defence=10,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&D(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(j);function U(t){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U(t)}function q(t,e,r){return e=H(e),function(t,e){if(e&&("object"==U(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,F()?Reflect.construct(e,r||[],H(t).constructor):e.apply(t,r))}function F(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(F=function(){return!!t})()}function H(t){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},H(t)}function J(t,e){return J=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},J(t,e)}var z=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=q(this,e,[t,"magician"])).attack=10,r.defence=40,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&J(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(j);function $(t){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$(t)}function Y(t,e,r){return e=K(e),function(t,e){if(e&&("object"==$(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,W()?Reflect.construct(e,r||[],K(t).constructor):e.apply(t,r))}function W(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(W=function(){return!!t})()}function K(t){return K=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},K(t)}function Q(t,e){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Q(t,e)}var V=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Y(this,e,[t,"daemon"])).attack=10,r.defence=10,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Q(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(j);function X(t){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X(t)}function Z(t,e,r){return e=et(e),function(t,e){if(e&&("object"==X(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,tt()?Reflect.construct(e,r||[],et(t).constructor):e.apply(t,r))}function tt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tt=function(){return!!t})()}function et(t){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},et(t)}function rt(t,e){return rt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},rt(t,e)}var nt=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Z(this,e,[t,"undead"])).attack=40,r.defence=10,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rt(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(j);function ot(t){return ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ot(t)}function it(t,e,r){return e=ct(e),function(t,e){if(e&&("object"==ot(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,at()?Reflect.construct(e,r||[],ct(t).constructor):e.apply(t,r))}function at(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(at=function(){return!!t})()}function ct(t){return ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ct(t)}function st(t,e){return st=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},st(t,e)}var ut=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=it(this,e,[t,"vampire"])).attack=25,r.defence=25,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&st(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(j);function lt(t){return lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lt(t)}function ft(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ht(n.key),n)}}function ht(t){var e=function(t){if("object"!=lt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=lt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==lt(e)?e:e+""}var pt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"from",value:function(t){return localStorage.setItem("state",JSON.stringify(t)),null}}],null&&ft(t.prototype,null),e&&ft(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function yt(t){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yt(t)}function dt(t){return function(t){if(Array.isArray(t))return mt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return mt(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?mt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function vt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,bt(n.key),n)}}function bt(t){var e=function(t){if("object"!=yt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=yt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yt(e)?e:e+""}var gt=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gamePlay=e,this.stateService=r},(e=[{key:"init",value:function(){this.gamePlay.drawUi(s.prairie),this.ui="prairie",this.scores=0,this.dangeLevel=1;for(var t=[V,nt,ut],e=g([I,R,z],2,2),r=g(t,2,2),n=w(2),o=C(2),i=[],a=0;a<2;a+=1)i.push({character:e.characters[a],position:n[a]});for(var c=0;c<2;c+=1)i.push({character:r.characters[c],position:o[c]});this.positionsCharacters=i,this.gamePlay.redrawPositions(i),this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addNewGameListener(this.newGame.bind(this)),this.gamePlay.addSaveGameListener(this.saveGame.bind(this)),this.gamePlay.addLoadGameListener(this.loadGame.bind(this))}},{key:"newGame",value:function(){window.localStorage.getItem("state")&&window.localStorage.removeItem("state"),this.gamePlay.drawUi(s.prairie),this.ui="prairie",this.scores=0,this.dangeLevel=1;for(var t=[V,nt,ut],e=g([I,R,z],2,2),r=g(t,2,2),n=w(2),o=C(2),i=[],a=0;a<2;a+=1)i.push({character:e.characters[a],position:n[a]});for(var c=0;c<2;c+=1)i.push({character:r.characters[c],position:o[c]});this.positionsCharacters=i,this.gamePlay.redrawPositions(i)}},{key:"saveGame",value:function(){pt.from([this.positionsCharacters,this.selectedBox,this.ui,this.scores])}},{key:"loadGame",value:function(){try{var t=JSON.parse(window.localStorage.getItem("state"));this.gamePlay.drawUi(s[t[2]]),this.positionsCharacters=t[0],this.selectedBox=t[1],this.scores=t[3],this.gamePlay.redrawPositions(this.positionsCharacters)}catch(t){throw new Error("Invalid state")}}},{key:"botDoAnyThing",value:function(){var t=this,e=this.positionsCharacters.filter((function(t){return"daemon"===t.character.type||"undead"===t.character.type||"vampire"===t.character.type})),r=this.positionsCharacters.filter((function(t){return"swordsman"===t.character.type||"bowman"===t.character.type||"magician"===t.character.type})),n=function(t,e){return Math.floor(t+Math.random()*(e+1-t))},o=n(0,e.length-1),i=S(e[o].position,e[o].character.type),a=P(e[o].position,e[o].character.type),c=!1,s=e[o].character;if(i.forEach((function(t){for(var e=0;e<r.length;e+=1)t===r[e].position&&(c=r[e])})),c){var u=Math.max(s.attack-c.character.defence,.1*s.attack);this.gamePlay.showDamage(c.position,u).then((function(e){if(c.character.health-=u,c.character.health<=0){t.selectedBox=void 0,Array.from(document.querySelectorAll(".selected")).forEach((function(t){t.classList.remove("selected"),t.classList.remove("selected-yellow")})),t.gamePlay.setCursor("unset"),t.positionsCharacters=t.positionsCharacters.filter((function(t){return t.character.health>=0}));var r=t.positionsCharacters.findIndex((function(t){return"swordsman"===t.character.type||"bowman"===t.character.type||"magician"===t.character.type}));-1===r&&t.newGame()}t.gamePlay.redrawPositions(t.positionsCharacters)}))}else{var l=n(0,a.length);this.gamePlay.cells[a[l]]&&(this.gamePlay.cells[a[l]].hasChildNodes()||(e[o].position=a[l]),this.gamePlay.redrawPositions([].concat(dt(r),dt(e))))}}},{key:"nextLevel",value:function(){switch(this.positionsCharacters.forEach((function(t){t.character.levelUp()})),this.ui){case"prairie":this.gamePlay.drawUi(s.desert),this.ui="desert";break;case"desert":this.gamePlay.drawUi(s.arctic),this.ui="arctic";break;case"arctic":this.gamePlay.drawUi(s.mountain),this.ui="mountain"}var t=[I,R,z],e=[V,nt,ut];switch(this.dangeLevel){case 1:this.dangeLevel=2;var r=w(3);this.positionsCharacters.forEach((function(t){t.position=r[0],r.splice(0,1)}));for(var n=C(3),o=g(e,3,n.length),i=g(t,3,r.length),a=0;a<r.length;a+=1)this.positionsCharacters.push({character:i.characters[a],position:r[a]});for(var c=0;c<n.length;c+=1)this.positionsCharacters.push({character:o.characters[c],position:n[c]});this.selectedBox=void 0,this.gamePlay.redrawPositions(this.positionsCharacters);break;case 2:this.dangeLevel=3;var u=w(5);this.positionsCharacters.forEach((function(t){t.position=u[0],u.splice(0,1)}));for(var l=C(5),f=g(e,4,l.length),h=g(t,4,u.length),p=0;p<u.length;p+=1)this.positionsCharacters.push({character:h.characters[p],position:u[p]});for(var y=0;y<l.length;y+=1)this.positionsCharacters.push({character:f.characters[y],position:l[y]});this.selectedBox=void 0,this.gamePlay.redrawPositions(this.positionsCharacters);break;case 3:this.dangeLevel=4;var d=w(5);this.positionsCharacters.forEach((function(t){t.position=d[0],d.splice(0,1)}));for(var m=C(5),v=g(e,4,m.length),b=g(t,4,d.length),P=0;P<d.length;P+=1)this.positionsCharacters.push({character:b.characters[P],position:d[P]});for(var S=0;S<m.length;S+=1)this.positionsCharacters.push({character:v.characters[S],position:m[S]});this.selectedBox=void 0,console.log(this.positionsCharacters),this.gamePlay.redrawPositions(this.positionsCharacters)}-1===this.positionsCharacters.findIndex((function(t){return"daemon"===t.character.type||"undead"===t.character.type||"vampire"===t.character.type}))&&4===this.dangeLevel&&"mountain"===this.ui&&(this.gamePlay.cellClickListeners=[],this.gamePlay.cellEnterListeners=[],this.gamePlay.cellLeaveListeners=[],this.gamePlay.saveGameListeners=[],this.gamePlay.loadGameListeners=[],Array.from(document.querySelectorAll(".selected")).forEach((function(t){return t.classList.remove("selected")})),this.selectedBox=void 0,this.gamePlay.setCursor("unset"))}},{key:"onCellClick",value:function(t){var e=this;if(this.gamePlay.cells[t].hasChildNodes()){var r=this.positionsCharacters.findIndex((function(e){return e.position===t}));"swordsman"!==this.positionsCharacters[r].character.type&&"bowman"!==this.positionsCharacters[r].character.type&&"magician"!==this.positionsCharacters[r].character.type||(void 0!==this.selectedBox&&this.gamePlay.deselectCell(this.selectedBox),this.selectedBox=t,this.gamePlay.selectCell(t))}if(void 0!==this.selectedBox&&!this.gamePlay.cells[t].hasChildNodes()){var n=this.positionsCharacters.findIndex((function(t){return t.position===e.selectedBox}));if(this.positionsCharacters[n]&&-1!==P(this.selectedBox,this.positionsCharacters[n].character.type).findIndex((function(e){return e===t}))){var o=this.gamePlay.cells[n];o.classList.remove("selected-green"),o.classList.remove("selected"),this.gamePlay.deselectCell(this.selectedBox),this.selectedBox=t,this.gamePlay.selectCell(t),this.positionsCharacters[n].position=t,this.gamePlay.redrawPositions(this.positionsCharacters),this.botDoAnyThing()}}if(void 0!==this.selectedBox&&this.gamePlay.cells[t].hasChildNodes()){var i=this.positionsCharacters.findIndex((function(t){return t.position===e.selectedBox})),a=this.positionsCharacters.findIndex((function(e){return e.position===t}));if(-1!==S(this.selectedBox,this.positionsCharacters[i].character.type).findIndex((function(e){return e===t}))){var c=this.positionsCharacters[i].character,s=this.positionsCharacters[a].character,u=Math.max(c.attack-s.defence,.1*c.attack);this.gamePlay.showDamage(t,u).then((function(t){if(s.health-=u,s.health<=0){e.positionsCharacters=e.positionsCharacters.filter((function(t){return t.character.health>=0}));var r=e.positionsCharacters.findIndex((function(t){return"daemon"===t.character.type||"undead"===t.character.type||"vampire"===t.character.type}));-1===r&&e.nextLevel()}e.gamePlay.redrawPositions(e.positionsCharacters),e.botDoAnyThing()}))}}}},{key:"onCellEnter",value:function(t){var e=this;if(void 0===this.selectedBox&&this.gamePlay.cells[t].hasChildNodes()){var r=this.positionsCharacters.findIndex((function(e){return e.position===t}));"undead"!==this.positionsCharacters[r].character.type&&"vampire"!==this.positionsCharacters[r].character.type&&"daemon"!==this.positionsCharacters[r].character.type||this.gamePlay.setCursor("not-allowed")}if(this.gamePlay.cells[t].hasChildNodes()){var n=this.positionsCharacters.findIndex((function(e){return e.position===t}));if("swordsman"!==this.positionsCharacters[n].character.type&&"bowman"!==this.positionsCharacters[n].character.type&&"magician"!==this.positionsCharacters[n].character.type||this.gamePlay.setCursor("pointer"),this.gamePlay.cells[t].hasChildNodes()){var o=this.positionsCharacters.findIndex((function(e){return e.position===t})),i=this.positionsCharacters.findIndex((function(t){return t.position===e.selectedBox}));if(this.positionsCharacters[i]){var a=S(this.selectedBox,this.positionsCharacters[i].character.type).findIndex((function(e){return e===t}));"undead"!==this.positionsCharacters[o].character.type&&"vampire"!==this.positionsCharacters[o].character.type&&"daemon"!==this.positionsCharacters[o].character.type||-1!==a&&(this.lastRedCircle=t,this.gamePlay.selectCell(t,"red"),this.gamePlay.setCursor("crosshair"))}}var c=this.positionsCharacters[n].character.level,s=this.positionsCharacters[n].character.attack,u=this.positionsCharacters[n].character.health,l=this.positionsCharacters[n].character.defence;this.gamePlay.showCellTooltip("🎖".concat(c," ⚔").concat(s," 🛡").concat(l," ❤").concat(u),t)}if(void 0!==this.selectedBox){var f=this.positionsCharacters.findIndex((function(t){return t.position===e.selectedBox}));if(this.positionsCharacters[f]){var h=P(this.selectedBox,this.positionsCharacters[f].character.type);-1===h.findIndex((function(e){return e===t}))||this.gamePlay.cells[t].hasChildNodes()||(this.gamePlay.selectCell(t,"green"),this.gamePlay.setCursor("pointer")),this.allowedPositionsToGo=h,this.lastGreenCircle=t}}}},{key:"onCellLeave",value:function(t){if(this.gamePlay.cells[t].hasChildNodes()&&(this.gamePlay.hideCellTooltip(t),this.gamePlay.setCursor("unset")),void 0!==this.selectedBox){if(void 0!==this.lastGreenCircle){var e=document.querySelector(".selected-green");e&&(e.classList.remove("selected-green"),e.classList.remove("selected")),this.gamePlay.setCursor("not-allowed")}if(void 0!==this.lastRedCircle){var r=document.querySelector(".selected-red");r&&(r.classList.remove("selected-red"),r.classList.remove("selected")),this.gamePlay.setCursor("not-allowed")}}}}])&&vt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function wt(t){return wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wt(t)}function Ct(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Pt(n.key),n)}}function Pt(t){var e=function(t){if("object"!=wt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=wt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==wt(e)?e:e+""}var St=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storage=e},(e=[{key:"save",value:function(t){this.storage.setItem("state",JSON.stringify(t))}},{key:"load",value:function(){try{return JSON.parse(this.storage.getItem("state"))}catch(t){throw new Error("Invalid state")}}}])&&Ct(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}(),Ot=new c;Ot.bindToDOM(document.querySelector("#game-container")),new gt(Ot,new St(localStorage)).init()})();